{% include 'components/navbar.html' %}
This is Catalog Template
<br>
<!-- shopping cart -->
<div class="cart">
    <h2>Shopping cart</h2>
    <ul class="cart-items">
      <!-- cart items will be dynamically added here -->
    </ul>
    <p>Total: $0</p>
    <input type="text" placeholder="Enter Your Phone Number" id="customer_phone_number" required>
    <button class="submit-order" onclick="return confirmDelete()">Submit order</button>
</div>
{% for temp in food_list %}
<div class="item">
    <a href=/{{temp.food_image}}><img src=/{{temp.food_image}} alt="Delicious food"></a>
    <h3 class="food-title">{{temp.food_title}}</h3>
    <p><span>Price: </span><span class="price">${{temp.food_price}}</span></p>
    <label for="quantity">Quantity:</label>
    <input type="number" id="quantity" value="1">
    <input type="hidden" name="owner" value={{key}}>
    <button class="add-to-cart">Add to cart</button>
  </div>
  

{% endfor %}


<script>
    // set up variables
const cartItems = [];
let phone_number;
let total = 0;

// add event listener to all "Add to cart" buttons
const addToCartButtons = document.querySelectorAll('.add-to-cart');
addToCartButtons.forEach(button => {
  button.addEventListener('click', () => {
    // get food item name, price, and quantity from DOM
    const foodItemName = button.parentElement.querySelector('h3').textContent;
    const foodItemPrice = parseFloat(button.parentElement.querySelector('.price').textContent.replace('$', ''));
    const quantity = parseInt(button.parentElement.querySelector('input[type="number"]').value);
    const key = button.parentElement.querySelector('input[name="owner"]').value;
    
    // add item to cart
    cartItems.push({ name: foodItemName, price: foodItemPrice, quantity, key:key });

    // update cart DOM
    updateCartDOM();
  });
});

// add event listener to "Submit order" button
// const submitOrderButton = document.querySelector('.submit-order');
// submitOrderButton.addEventListener('click', () => {
//   // send cartItems array to server to process order
//   console.log(cartItems);
// });
const submitOrderButton = document.querySelector('.submit-order');
submitOrderButton.addEventListener('click', () => {
  // Get the CSRF token from the cookie
  phone_number=document.getElementById('customer_phone_number').value;
  const csrftoken = getCookie('csrftoken');
  
  // Send cartItems array to server to process order
  fetch('/submit_order', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/x-www-form-urlencoded',
      'X-CSRFToken': csrftoken,
    },
    body: 'cartItems=' + encodeURIComponent(JSON.stringify(cartItems)),
    
  })



  console.log(cartItems);
  console.log(phone_number);
// Check if Geolocation API is available
if ('geolocation' in navigator) {
  // Request user's permission to access location
  navigator.geolocation.getCurrentPosition(
    function(position) {
      // Callback function on successful retrieval of location
      var latitude = position.coords.latitude;
      var longitude = position.coords.longitude;
      
      // Use the latitude and longitude as needed
      console.log('Latitude: ' + latitude);
      console.log('Longitude: ' + longitude);
      
      // You can perform further actions with the location data here
    },
    function(error) {
      // Callback function on error
      console.log('Error occurred. Error code: ' + error.code + '. Error message: ' + error.message);
    }
  );
} else {
  // Geolocation API is not supported
  console.log('Geolocation is not supported by this browser.');
}
});

// Function to retrieve a specific cookie value
function getCookie(name) {
  const value = `; ${document.cookie}`;
  const parts = value.split(`; ${name}=`);
  if (parts.length === 2) return parts.pop().split(';').shift();
}

// function to update cart DOM
function updateCartDOM() {
  // get cart DOM elements
  const cartItemsList = document.querySelector('.cart-items');
  const totalDOM = document.querySelector('.cart p');

  // clear cart items list
  cartItemsList.innerHTML = '';

  // loop through cart items and add to DOM
  cartItems.forEach(item => {
    const itemDOM = document.createElement('li');
    itemDOM.textContent = `${item.name} x ${item.quantity} - $${item.price * item.quantity}`;
    cartItemsList.appendChild(itemDOM);
  });

  // calculate and update total
  total = cartItems.reduce((acc, item) => acc + item.price * item.quantity, 0);
  totalDOM.textContent = `Total: $${total}`;
}

</script>
<script>
  function confirmDelete() {
    return confirm("Are you sure you want to delete item?");
  }
</script>